# VCR0030: Nested Result detected

| Property    | Value                          |
|-------------|--------------------------------|
| **Rule ID** | VCR0030                        |
| **Category**| Usage                          |
| **Severity**| Warning                        |
| **Enabled** | Yes                            |

## Description

Using `Map` with a function that returns `Result<T>` produces a nested `Result<Result<T>>`. Use `Bind` (or `BindAsync`) instead to flatten the result — this is a fundamental rule of monadic composition.

## Examples

### Violating code

```csharp
// VCR0030: 'Map' produces nested Result<Result<Order>>
var result = GetUser(id)
    .Map(user => GetOrder(user.Id));  // GetOrder returns Result<Order>
// result is Result<Result<Order>> — not what you want

// Same issue with async
var result = await GetUserAsync(id)
    .MapAsync(user => GetOrderAsync(user.Id));  // Result<Result<Order>>
```

### Fixed code

```csharp
// Use Bind — automatically flattens the result
var result = GetUser(id)
    .Bind(user => GetOrder(user.Id));  // Result<Order>

// Async version
var result = await GetUserAsync(id)
    .BindAsync(user => GetOrderAsync(user.Id));  // Result<Order>
```

## Rule of thumb

| Lambda return type | Use operator |
|-------------------|-------------|
| `T` (plain value) | `Map` |
| `Result<T>` | `Bind` |
| `Task<Result<T>>` | `BindAsync` |

## When to suppress

This rule should generally not be suppressed — nested Results are almost always a bug.

```editorconfig
# .editorconfig
[*.cs]
dotnet_diagnostic.VCR0030.severity = error  # Upgrade to error (recommended)
```

## See also

- [VCR0040 — GetValueOrThrow defeats Result pattern](VCR0040.md)
- [Railway Oriented Programming](../railway-oriented.md)
